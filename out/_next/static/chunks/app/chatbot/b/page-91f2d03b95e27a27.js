(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[547],{428:(t,e,a)=>{"use strict";a.r(e),a.d(e,{default:()=>l});var s=a(5155),n=a(2115),c=a(4706),o=a(8565),i=a.n(o),r=a(6766);function l(){let[t,e]=(0,n.useState)([{role:"assistant",type:"text",content:"안녕하세요! 펠드만 비평(묘사→분석→해석→판단)으로 작품 감상을 도와드릴게요. 궁금한 게 있다면 언제든지 질문주세요! 가장 먼저 1단계(Description) 진행해볼게요. 연구원에게 안내받은 작품을 한 문장으로 묘사해 주시겠어요?"}]),[a,o]=(0,n.useState)(""),[l,_]=(0,n.useState)(!1),[h,b]=(0,n.useState)(null),u=(0,n.useRef)(null),d=async s=>{if(s.preventDefault(),!a.trim()&&!h)return;let n=[];a.trim()&&n.push({type:"text",text:a.trim()}),h&&n.push({type:"image_url",image_url:{url:h}});let c={role:"user",type:"mixed",content:n};e(t=>[...t,c,{role:"assistant",type:"text",content:""}]),o(""),b(null),_(!0);try{let a=[...t.filter(t=>"assistant"!==t.role||""!==t.content),c],s=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:a})});if(!s.body)throw Error("스트림이 비었습니다.");let n=s.body.getReader(),o=new TextDecoder("utf-8"),r="";for(;;){var i;let{value:t,done:a}=await n.read();if(a)break;r+=o.decode(t,{stream:!0}),e(t=>{let e=[...t];return e[e.length-1]={role:"assistant",type:"text",content:r},e}),null==(i=u.current)||i.scrollTo({top:u.current.scrollHeight,behavior:"smooth"})}}catch(t){e(e=>[...e,{role:"assistant",type:"text",content:"오류가 발생했어요: ".concat(t.message)}])}finally{_(!1)}},m=async t=>{let e=t.target.files[0];e&&b(await new Promise((t,a)=>{let s=new FileReader;s.readAsDataURL(e),s.onload=()=>t(s.result),s.onerror=t=>a(t)}))},p=async()=>{await (0,c.QX)("B타입 대화",t,"b");let e=new Blob([t.map(t=>Array.isArray(t.content)?t.content.map(e=>"text"===e.type?"[".concat(t.role,"] ").concat(e.text):"[".concat(t.role,"] [이미지 첨부: ").concat(e.image_url.url.substring(0,50),"...]")).join("\n"):"[".concat(t.role,"] ").concat(t.content)).join("\n\n")],{type:"text/plain"}),a=URL.createObjectURL(e),s=document.createElement("a");s.href=a,s.download="chat-history-b.txt",s.click(),URL.revokeObjectURL(a),alert("채팅 기록이 저장되고, 파일이 다운로드되었습니다 ✅")};return(0,s.jsxs)("main",{className:i().chat,style:{position:"relative"},children:[(0,s.jsx)("h1",{className:i().title,children:"Type B Chatbot"}),(0,s.jsx)("button",{onClick:p,className:i().saveBtnFixed,children:"채팅 기록 저장"}),(0,s.jsx)("div",{ref:u,className:i().chatBox,children:t.map((t,e)=>(0,s.jsx)("div",{className:"".concat(i().messageRow," ").concat("user"===t.role?i().right:i().left),children:Array.isArray(t.content)?(0,s.jsx)("div",{className:"user"===t.role?i().bubbleUser:i().bubbleAssistant,children:t.content.map((t,e)=>"text"===t.type?(0,s.jsx)("p",{children:t.text},e):(0,s.jsx)(r.default,{src:t.image_url.url,alt:"첨부 이미지",width:300,height:200,className:i().chatImage},e))}):"image"===t.type?(0,s.jsx)(r.default,{src:t.content,alt:"첨부 이미지",width:300,height:200,className:i().chatImage}):(0,s.jsx)("div",{className:"user"===t.role?i().bubbleUser:i().bubbleAssistant,children:t.content})},e))}),(0,s.jsxs)("form",{onSubmit:d,className:i().form,children:[(0,s.jsx)("input",{id:"fileInput",type:"file",accept:"image/*",onChange:m,style:{display:"none"}}),(0,s.jsx)("button",{type:"button",onClick:()=>document.getElementById("fileInput").click(),className:i().attachBtn,children:"+"}),(0,s.jsx)("input",{value:a,onChange:t=>o(t.target.value),placeholder:"메시지를 입력하세요...",className:i().input}),(0,s.jsx)("button",{disabled:l,className:"".concat(i().button," ").concat(l?i().disabled:""),children:l?"생성 중…":"보내기"})]}),h&&(0,s.jsxs)("div",{className:i().previewBox,children:[(0,s.jsx)("p",{children:"첨부된 이미지:"}),(0,s.jsx)(r.default,{src:h,alt:"미리보기",width:300,height:200,className:i().previewImage})]})]})}},1252:(t,e,a)=>{Promise.resolve().then(a.bind(a,428))},4706:(t,e,a)=>{"use strict";a.d(e,{Gt:()=>i,QX:()=>_,QY:()=>r,jw:()=>o,zX:()=>l});var s=a(198);let n="histories";async function c(){return(0,s.P2)("feldman_chat_db",1,{upgrade(t){t.objectStoreNames.contains(n)||t.createObjectStore(n,{keyPath:"id",autoIncrement:!0})}})}async function o(t){let e=await c(),a=new Date().toLocaleString();await e.add(n,{title:"새 ".concat(t.toUpperCase()," 대화 (").concat(a,")"),messages:[],type:t,createdAt:a})}async function i(t,e){let a=await c(),s=await a.get(n,t);s&&(s.title=e,await a.put(n,s))}async function r(){let t=await c();return await t.getAll(n)}async function l(t){let e=await c();return await e.get(n,t)}async function _(t,e,a){let s=await c(),o=new Date().toLocaleString();await s.add(n,{title:t||"대화 (".concat(o,")"),messages:e,type:a,createdAt:o})}},8565:t=>{t.exports={layout:"chatbot_layout__tt6Yv",sidebarWrapper:"chatbot_sidebarWrapper__BZ9S9",open:"chatbot_open__aAxWk",sidebarToggle:"chatbot_sidebarToggle__TFyUC",sidebarHeader:"chatbot_sidebarHeader__kXtPL",homeBtn:"chatbot_homeBtn__IvHR_",newSessionBtn:"chatbot_newSessionBtn__xXWHs",sessionList:"chatbot_sessionList__UUOwZ",sessionItem:"chatbot_sessionItem__DvGxH",sessionLink:"chatbot_sessionLink__NmtSE",sessionInput:"chatbot_sessionInput__3UYvc",editBtn:"chatbot_editBtn__2owYW",chat:"chatbot_chat__Yb4t2",title:"chatbot_title__uiKgD",chatBox:"chatbot_chatBox__k7xrM",messageRow:"chatbot_messageRow__1_4v3",left:"chatbot_left__hHdSl",right:"chatbot_right__5DjCX",bubbleAssistant:"chatbot_bubbleAssistant__NY2B5",bubbleUser:"chatbot_bubbleUser__mo7Ss",form:"chatbot_form__ZMP6s",input:"chatbot_input__CgOcK",button:"chatbot_button__vs6lv",saveBtnFixed:"chatbot_saveBtnFixed__ypo9G",chatImage:"chatbot_chatImage__G1Uli",previewBox:"chatbot_previewBox__Yu0DP",previewImage:"chatbot_previewImage__L7B5e",attachBtn:"chatbot_attachBtn__sSjAC"}}},t=>{t.O(0,[414,945,441,964,358],()=>t(t.s=1252)),_N_E=t.O()}]);